<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image2PCE II</title>
    <script type="module" src="/main.js" defer></script>
  </head>

  <body>
    <main class="app">
      <header class="topbar">
        <div class="brand">
          <span class="brand__title">Image2PCE II</span>
          <span class="brand__subtitle">Convertisseur d'images PC-Engine</span>
        </div>
        <div class="actions">
          <button class="btn" id="open-image">Open image</button>
          <button class="btn" id="save-image">Save as image</button>
          <button class="btn" id="save-binaries">Save binaries</button>
          <button class="btn" id="save-text">Save .asm</button>
          <label class="vram-address-label">
            VRAM
            <input type="text" id="vram-address" value="$4000" size="6" placeholder="$4000" />
          </label>
        </div>
      </header>

      <section class="settings">
        <div class="settings__group">
          <label>
            Redimensionnement
            <select id="resize-method">
              <option value="lanczos">lanczos</option>
              <option value="nearest">nearest</option>
              <option value="catmullrom">catmullrom</option>
            </select>
          </label>
          <label>
            Nombre de palettes
            <input id="palette-count" type="number" min="1" max="16" value="16" />
          </label>
          <label>
            Couleur 0
            <div class="color0-selector">
              <select id="color0-mode">
                <option value="auto">auto</option>
                <option value="fixed">fix√©e</option>
              </select>
              <div class="color0-preview" id="color0-preview" title="Cliquez sur une couleur dans les palettes"></div>
            </div>
          </label>
          <label>
            Dithering
            <select id="dither-mode">
              <option value="none">aucun</option>
              <option value="floyd">Floyd‚ÄìSteinberg</option>
              <option value="ordered">ordered</option>
            </select>
          </label>
          <label>
            Couleur de fond
            <input id="background-color" type="color" value="#000000" />
          </label>
        </div>
        <div class="settings__group">
          <label>
            Transparence
            <input id="transparency" type="checkbox" checked />
          </label>
          <label>
            Keep ratio
            <input id="keep-ratio" type="checkbox" checked />
          </label>
          <label>
            Masque dithering
            <input id="dither-mask" type="checkbox" />
          </label>
          <button class="btn btn--primary" id="run-conversion">Convertir</button>
        </div>
        <div class="settings__group settings__group--size">
          <label>
            Largeur
            <input id="output-width-tiles" type="range" min="32" max="128" value="32" />
            <span id="output-width-value">32 (256 px)</span>
          </label>
          <label>
            Hauteur
            <input id="output-height-tiles" type="range" min="32" max="64" value="32" />
            <span id="output-height-value">32 (256 px)</span>
          </label>
        </div>
        <div class="settings__group settings__group--curve">
          <div class="curve-editor">
            <div class="curve-editor__header">
              <span class="curve-editor__title">Courbe RGB333</span>
              <button class="btn btn--small" id="curve-reset">Reset</button>
            </div>
            <div class="curve-editor__canvas-wrapper">
              <canvas id="curve-canvas" width="256" height="256"></canvas>
            </div>
            <div class="curve-editor__info">
              <span id="curve-info">Entr√©e: ‚Äî Sortie: ‚Äî</span>
            </div>
          </div>
        </div>
        <div class="settings__group settings__group--histogram">
          <div class="histogram">
            <div class="histogram__header">
              <span class="histogram__title">Histogramme (sortie)</span>
            </div>
            <div class="histogram__canvas-wrapper">
              <canvas id="histogram-canvas" width="256" height="100"></canvas>
            </div>
          </div>
        </div>
        <div class="settings__group settings__group--export">
          <span class="settings__group-title">Export Big-Endian</span>
          <label>
            BAT
            <input id="bat-big-endian" type="checkbox" />
          </label>
          <label>
            Palettes
            <input id="pal-big-endian" type="checkbox" />
          </label>
          <label>
            Tiles
            <input id="tiles-big-endian" type="checkbox" />
          </label>
        </div>
      </section>

      <section class="viewer">
        <div class="viewer__panel">
          <div class="viewer__header">
            <h2>Source</h2>
            <span class="viewer__meta" id="input-meta">Aucune image charg√©e</span>
          </div>
          <div class="viewer__canvas" id="input-canvas">
            <p>Chargez une image pour commencer.</p>
          </div>
          <div class="viewer__toolbar viewer__toolbar--mask" id="mask-toolbar">
            <button class="btn btn--small btn--icon" id="mask-toggle" title="Activer/d√©sactiver l'√©dition du masque">
              <span class="mask-toggle-icon">‚úèÔ∏è</span>
            </button>
            <div class="mask-tools" id="mask-tools">
              <button class="btn btn--small btn--icon is-active" id="mask-brush" title="Pinceau (zone avec dithering) - X pour alterner">üñåÔ∏è</button>
              <button class="btn btn--small btn--icon" id="mask-eraser" title="Gomme (zone sans dithering) - X pour alterner">üßΩ</button>
              <button class="btn btn--small btn--icon" id="mask-circle" title="Cercle plein (double-clic = mode effacer)">‚≠ï</button>
              <button class="btn btn--small btn--icon" id="mask-rectangle" title="Rectangle plein (double-clic = mode effacer)">‚¨ú</button>
              <button class="btn btn--small btn--icon" id="mask-polygon" title="Polygone (double-clic ou fermer = terminer)">üî∑</button>
              <button class="btn btn--small btn--icon" id="mask-undo" title="Annuler (Ctrl+Z)">‚Ü©Ô∏è</button>
              <button class="btn btn--small btn--icon" id="mask-redo" title="R√©tablir (Ctrl+Y)">‚Ü™Ô∏è</button>
              <label class="mask-brush-size">
                <span>Taille</span>
                <input type="range" id="mask-brush-size" min="5" max="100" value="20" />
                <span id="mask-brush-size-value">20</span>
              </label>
              <button class="btn btn--small" id="mask-clear-white" title="Tout effacer (sans dithering)">Effacer</button>
              <button class="btn btn--small" id="mask-fill-black" title="Tout remplir (avec dithering)">Remplir</button>
              <button class="btn btn--small" id="mask-invert" title="Inverser le masque">Inverser</button>
            </div>
          </div>
          <div class="viewer__zoom">
            <label>
              Zoom source
              <input id="zoom-input" type="range" min="1" max="8" value="2" />
            </label>
          </div>
        </div>
        <div class="viewer__splitter" id="viewer-splitter"></div>
        <div class="viewer__panel">
          <div class="viewer__header">
            <h2>Sortie</h2>
            <span class="viewer__meta" id="output-meta">En attente de conversion</span>
          </div>
          <div class="viewer__canvas-wrapper">
            <div class="viewer__canvas" id="output-canvas">
              <p>Le rendu final appara√Ætra ici.</p>
            </div>
            <div class="crt-overlay" id="crt-overlay"></div>
            <div class="progress-overlay" id="progress-overlay">
              <div class="progress-bar">
                <div class="progress-bar__fill" id="progress-fill"></div>
              </div>
              <span class="progress-text" id="progress-text">Conversion en cours...</span>
            </div>
          </div>
          <div class="viewer__toolbar">
            <span>Survol: palette de la tuile active</span>
            <div class="palette-tooltip" id="palette-tooltip"></div>
          </div>
          <div class="viewer__toolbar viewer__toolbar--tile-editor" id="tile-editor-toolbar">
            <button class="btn btn--small btn--icon" id="tile-editor-toggle"
                    title="Activer/d√©sactiver l'√©dition des tuiles">
              <span class="tile-editor-toggle-icon">üé®</span>
            </button>
            <div class="tile-editor-tools" id="tile-editor-tools">
              <button class="btn btn--small btn--icon is-active" id="tile-editor-brush" title="Pinceau - dessiner des pixels">üñåÔ∏è</button>
              <button class="btn btn--small btn--icon" id="tile-editor-select" title="S√©lection - verrouiller par palette">üîç</button>
              <span class="tile-editor-separator"></span>
              <span class="tile-editor-label">Palette: <strong id="tile-editor-palette-num">-</strong></span>
              <span class="tile-editor-separator"></span>
              <span class="tile-editor-label">Couleur:</span>
              <div class="tile-editor-palette" id="tile-editor-palette"></div>
              <span class="tile-editor-separator"></span>
              <button class="btn btn--small btn--icon" id="tile-editor-undo" title="Annuler (Ctrl+Z)">‚Ü©Ô∏è</button>
              <button class="btn btn--small btn--icon" id="tile-editor-redo" title="R√©tablir (Ctrl+Y)">‚Ü™Ô∏è</button>
            </div>
          </div>
          <div class="viewer__zoom">
            <label>
              Zoom sortie
              <input id="zoom-output" type="range" min="1" max="8" value="2" />
            </label>
            <label>
              Simulation CRT
              <select id="crt-mode">
                <option value="none">Aucune</option>
                <option value="scanlines">Scanlines</option>
                <option value="aperture">Aperture Grille</option>
                <option value="shadowmask">Shadow Mask</option>
                <option value="composite">Composite</option>
              </select>
            </label>
                      </div>
        </div>
        <div class="viewer__resize-handle" id="viewer-resize-handle"></div>
      </section>

      <section class="palettes">
        <div class="palettes__header">
          <h2>Palettes g√©n√©r√©es</h2>
          <span id="palette-summary">0 palette utilis√©e</span>
        </div>
        <div class="palettes__grid" id="palettes-grid">
          <div class="palette-card">
            <div class="palette-card__title">Palette 0</div>
            <div class="palette-card__colors"></div>
          </div>
        </div>
      </section>

      <!-- Tile Editor Context Menu -->
      <div id="tile-context-menu" class="context-menu">
        <button id="convert-to-palette-btn">Convert to palette...</button>
      </div>

      <!-- Palette Selector Modal -->
      <div id="palette-selector-modal" class="modal">
        <div class="modal__content">
          <h3>Select target palette</h3>
          <div id="palette-selector-grid"></div>
          <button class="btn" id="palette-selector-cancel">Cancel</button>
        </div>
      </div>
    </main>
  </body>
</html>
